<h2>Manage Appointments</h2>
<br/>
<div *ngIf="error" class="alert alert-danger">{{ error }}</div>
<table *ngIf="appointmentsObservable | async as appointments; else loading" class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Doctor name</th>
            <th>From</th>
			<th>To</th>
			<th>Prefer online</th>
            <th>Contains file</th>
            <th>Is accepted</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let appointment of appointments">
            <td>{{ appointment.event.label }}</td>
            <td>{{ appointment.event.start.toISOString().split('T')[0] }}</td>
			<td>{{ appointment.event.end.toISOString().split('T')[0] }}</td>
			<td *ngIf="appointment.preferOnline; else noForm" class="text-center"><fa-icon [icon]="['fas', 'check']"></fa-icon></td>
            <ng-template #noForm>
                <td></td>
            </ng-template>
            <td *ngIf="appointment.containsFile; else noForm1" class="text-center"><fa-icon [icon]="['fas', 'check']"></fa-icon></td>
            <ng-template #noForm1>
                <td></td>
            </ng-template>
            <td *ngIf="appointment.event.isAccepted; else noForm2" class="text-center"><fa-icon [icon]="['fas', 'check']"></fa-icon></td>
            <ng-template #noForm2>
                <td></td>
			</ng-template>
            <td *ngIf="!appointment.event.isAccepted; else noForm3" >
                <a (click)="editAppointmentData(appointment)"><fa-icon [icon]="['far', 'calendar-alt']" style="color:blue; font-size: large;"></fa-icon></a>&nbsp;&nbsp;&nbsp;&nbsp;
				<a (click)="deleteAppointment(appointment.id)"><fa-icon [icon]="['far', 'calendar-times']" style="color:red; font-size: large;"></fa-icon></a>
			</td>
			<ng-template #noForm3>
                <td></td>
			</ng-template>
        </tr>
    </tbody>
</table>
<ng-template #loading>
    <div class="d-flex justify-content-center">
        <div class="spinner-border text-primary" style="width: 5rem; height: 5rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</ng-template>

<ng-template #editAppointment let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Edit appointment</h5>
        <button type="button" class="btn btn-danger text-white btn-block col-sm-1" (click)="close()"><fa-icon [icon]="['fas', 'times']" ></fa-icon></button>
    </div>
    <div class="modal-body">
        <h5 for="description">Short description</h5>
        <textarea #description id="description" name="description" ngModel="{{ storedDescription }}" class="form-control" placeholder="Description" clos="50" rows="10"></textarea>
        <br/>
		<a *ngIf="selectedAppointment?.containsFile" class="btn btn-lg btn-info text-white btn-block" (click)="downloadMedicalReport()">Download Current Medical Report</a>
        <br/>
        <label for="medicalReport" class="sr-only">Medical Report</label>
        <div *ngIf="!fileIsSelected(file.files)" class="alert alert-warning">Medical report is not choosen</div>
        <input #file type="file" accept=".zip,.rar,.7zip" id="file" name="file" placeholder="Browse Medical Report" class="hide">
        <a class="btn btn-lg btn-info text-white btn-block" (click)="file.click()">Browse Medical Report</a>
		<br/>
		<h5 [hidden]="selectedAppointment?.preferOnline"><input #preferOnline type="checkbox" id="preferOnline" name="preferOnline" checked> Prefer online examination.</h5>
		<h5 [hidden]="!selectedAppointment?.preferOnline"><input #preferOnline type="checkbox" id="preferOnline" name="preferOnline"> Prefer online examination.</h5>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success text-white btn-block col-sm-2" (click)="close({preferOnline: preferOnline.checked, description: description.value, files: file.files})">Save</button>
    </div>
</ng-template>

<ng-template #editSuccess let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Edit appointment</h5>
        <button type="button" class="btn btn-danger text-white btn-block col-sm-1" (click)="close()"><fa-icon [icon]="['fas', 'times']" ></fa-icon></button>
    </div>
    <div class="modal-body">
        <p>
            Edition was successfull.
        </p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success text-white btn-block col-sm-2" (click)="close()">Ok</button>
    </div>
</ng-template>

<ng-template #editFailure let-close="close">
    <div class="modal-header">
        <h5 class="modal-title">Edit appointment</h5>
        <button type="button" class="btn btn-danger text-white btn-block col-sm-1" (click)="close()"><fa-icon [icon]="['fas', 'times']" ></fa-icon></button>
    </div>
    <div class="modal-body">
        <p>Edition was unsuccessfull.</p>
        <p>By clicking to save button you can temprarly can store your description and load it again to the appointment.</p>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success text-white btn-block col-sm-2" (click)="close(true)">Save</button>
        <button type="button" class="btn btn-danger text-white btn-block col-sm-2" (click)="close(false)">Leave</button>
    </div>
</ng-template>